name = "doxygen"
description = "Code Documentation. Automated."
homepage = "https://github.com/doxygen/doxygen"
alternatives = []
version = "1.14.0"
updated = "2025-05-24"
package-url = "https://github.com/doxygen/doxygen/releases/download/Release_{{(replace, version, '.', '_')}}/doxygen-{{version}}.linux.bin.tar.gz"
version-pattern = "^Release_\\d+_\\d+_\\d+$"

[extract]
strip = 1

[[extract.files]]
source = "bin/doxygen"
target = "{{vars.bin-path}}/doxygen"
mode = "0755"

#
# build configuration
#

[build]
package-url = "https://github.com/doxygen/doxygen/archive/refs/tags/Release_{{(replace, version, '.', '_')}}/doxygen-{{version}}.tar.gz"
version-pattern = "^Release_\\d+_\\d+_\\d+$"

[[build.script]]
name = "build_doxygen.sh"
content = [
    "set -e",
    "apk add \\",
    "  binutils bison cmake compiler-rt flex g++ gnu-libiconv \\",
    "  lld make musl-dev python3 xz",
    "tar xzf doxygen-{{version}}.tar.gz --strip-components=1",
    "printf '\nset(CPACK_GENERATOR TXZ)\n' >> cmake/packaging.cmake",
    "cmake -S . -B build \\",
    "  -D CMAKE_BUILD_TYPE=MinSizeRel \\",
    "  -D CMAKE_EXE_LINKER_FLAGS=-static \\",
    "  -D CMAKE_FIND_LIBRARY_SUFFIXES=.a",
    "cmake --build build --config MinSizeRel  --parallel {{vars.num-parallel}} --target package",
    "mv build/doxygen-{{version}}-.x86_64.tar.xz doxygen-{{version}}.linux.x86_64.tar.xz"
]

[[build.step]]
command = ["podman", "run", "--rm", "-it", "-v", "$PWD:$PWD", "-w", "$PWD", "alpine:3.22", "sh", "build_doxygen.sh"]

[[build.publish]]
repository-name = "packages"
repository-path = "doxygen"
files = ["doxygen-{{version}}.linux.x86_64.tar.xz"]
